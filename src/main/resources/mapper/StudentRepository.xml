<?xml version="1.0" encoding="UTF-8"?>
  <!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="raisetech.StudentManagement.repository.StudentRepository">

  <!-- 受講生の全件検索 -->
  <select id="findAllActiveStudents" resultType="raisetech.StudentManagement.data.Student">
    SELECT * FROM students WHERE deleted = false
  </select>

  <!-- 受講生コース情報の全件検索 -->
  <select id="findAllActiveCourses" resultType="raisetech.StudentManagement.data.StudentCourse">
    SELECT * FROM students_courses WHERE deleted = false
  </select>


  <!-- 受講生の単一検索 -->
  <select id="findStudentById" resultType="raisetech.StudentManagement.data.Student">
   SELECT * FROM students WHERE id = #{id}
  </select>

  <!-- 受講生の受講コースの単一検索 -->
  <select id="findCoursesByStudentId" resultType="raisetech.StudentManagement.data.StudentCourse">
    SELECT * FROM students_courses WHERE student_id = #{studentId}
  </select>


  <!-- 受講生のIDを自動採番 -->
  <select id="findMaxStudentId" resultType="String">
  SELECT id FROM students ORDER BY id DESC LIMIT 1
  </select>


  <!-- 受講生の登録 -->
 <insert id="insertStudent" parameterType="raisetech.StudentManagement.data.Student">
  INSERT INTO students
    (id, name, kana_name, nickname, email, address, age, gender, remark, deleted)
   VALUES
     (#{id}, #{name}, #{kanaName}, #{nickname}, #{email}, #{address}, #{age}, #{gender}, #{remark}, #{deleted})
  </insert>

  <!-- 受講生の受講コースを登録 -->
  <insert id="insertStudentCourses" parameterType="raisetech.StudentManagement.data.StudentCourse">
   INSERT INTO students_courses
    (id, student_id, course_name, course_start_at, course_end_at)
   VALUES
    (#{id}, #{studentId}, #{courseName}, #{courseStartAt}, #{courseEndAt})
  </insert>


  <!-- 受講生の情報を更新 -->
  <update id="updateStudent" parameterType="raisetech.StudentManagement.data.Student">
   UPDATE students
    SET name = #{name},
    kana_name = #{kanaName},
    nickname = #{nickname},
    email = #{email},
    address = #{address},
    age = #{age},
    gender = #{gender},
    remark = #{remark},
    deleted = #{deleted}
   WHERE id = #{id}
  </update>


  <!-- 受講生のコース情報を更新 -->
  <update id="updateStudentCourses" parameterType="raisetech.StudentManagement.data.StudentCourse">
   UPDATE students_courses
    SET course_name = #{courseName},
        course_start_at = #{courseStartAt},
        course_end_at = #{courseEndAt}
    WHERE id = #{id}
  </update>

  <!-- 受講生のコース情報を理論削除 -->
  <update id="updateStudentCourseDeleted" parameterType="raisetech.StudentManagement.data.StudentCourse">
   UPDATE students_courses
　    SET  deleted = true
   WHERE id = #{id}
  </update>


  </mapper>